<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HS마스터</title>
    <style>
        body {
            font-family: 'Nanum Gothic', Arial, sans-serif;
            text-align: center;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.6;
        }
        .screen {
            display: none;
        }
        .active {
            display: block;
        }
        .question {
            margin: 20px 0;
            font-size: 1.2em;
        }
        .options {
            display: flex;
            justify-content: center;
            gap: 20px;
        }
        .option {
            margin: 10px;
            cursor: pointer;
            padding: 10px 20px;
            border: 2px solid #007bff;
            border-radius: 5px;
            transition: background-color 0.3s, color 0.3s;
        }
        .option:hover, .option:focus {
            background-color: #007bff;
            color: white;
        }
        .feedback {
            font-size: 1.5em;
            font-weight: bold;
            margin: 20px 0;
        }
        .button {
            margin-top: 20px;
            padding: 10px 20px;
            cursor: pointer;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 1em;
            transition: background-color 0.3s;
        }
        .button:hover, .button:focus {
            background-color: #0056b3;
        }
        #quiz-results {
            text-align: left;
            margin: 20px 0;
        }
        .correct {
            color: green;
        }
        .incorrect {
            color: red;
        }
        #error-message {
            color: red;
            font-weight: bold;
        }
        @media (max-width: 600px) {
            .options {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div id="start-screen" class="screen active">
        <h1>HS마스터</h1>
        <p>HS부호를 보고 한글품목명을 맞추는 퀴즈입니다. 총 10문제가 출제됩니다.</p>
        <button id="start-button" class="button">시작하기</button>
    </div>

    <div id="quiz-screen" class="screen">
        <h2 id="hs-code" aria-live="polite"></h2>
        <div class="options">
            <button id="option1" class="option"></button>
            <button id="option2" class="option"></button>
        </div>
        <div id="feedback" class="feedback" aria-live="assertive"></div>
        <div id="progress"></div>
    </div>

    <div id="result-screen" class="screen">
        <h2>퀴즈 결과</h2>
        <div id="quiz-results"></div>
        <button id="retry-button" class="button">다시 풀기</button>
        <button id="capture-button" class="button">캡처하기</button>
    </div>

    <div id="error-message" aria-live="assertive"></div>

    <script>
        let hsData = [];
        let currentQuestionIndex = 0;
        let correctAnswers = [];
        let incorrectAnswers = [];
        let quizQuestions = [];

        async function loadHSData() {
            try {
                const response = await fetch("hscode.csv");
                if (!response.ok) {
                    throw new Error('CSV 파일을 불러올 수 없습니다.');
                }
                const text = await response.text();
                const rows = text.split("\n").map(row => row.split(","));
                hsData = rows.filter(row => row.length === 2).map(row => ({ hsCode: row[0], itemName: row[1] }));
                if (hsData.length === 0) {
                    throw new Error('CSV 파일에 유효한 데이터가 없습니다.');
                }
            } catch (error) {
                document.getElementById("error-message").textContent = error.message;
                throw error;
            }
        }

        document.getElementById("start-button").addEventListener("click", async () => {
            try {
                await loadHSData();
                quizQuestions = generateQuizQuestions();
                startQuiz();
            } catch (error) {
                console.error('퀴즈를 시작할 수 없습니다:', error);
            }
        });

        function generateQuizQuestions() {
            return hsData.sort(() => Math.random() - 0.5).slice(0, 10);
        }

        function startQuiz() {
            currentQuestionIndex = 0;
            correctAnswers = [];
            incorrectAnswers = [];
            showScreen("quiz-screen");
            showQuestion();
        }

        function showQuestion() {
            const question = quizQuestions[currentQuestionIndex];
            document.getElementById("hs-code").textContent = `HS 부호: ${question.hsCode}`;
            const options = generateOptions(question.itemName);
            const optionElements = document.querySelectorAll(".option");
            optionElements.forEach((option, index) => {
                option.textContent = options[index];
                option.disabled = false;
                option.onclick = () => checkAnswer(option.textContent, question);
            });
            updateProgress();
        }

        function generateOptions(correctAnswer) {
            const wrongAnswer = hsData.filter(item => item.itemName !== correctAnswer)[Math.floor(Math.random() * (hsData.length - 1))].itemName;
            return Math.random() > 0.5 ? [correctAnswer, wrongAnswer] : [wrongAnswer, correctAnswer];
        }

        function checkAnswer(selectedAnswer, question) {
            const feedbackElement = document.getElementById("feedback");
            if (selectedAnswer === question.itemName) {
                correctAnswers.push(question);
                feedbackElement.textContent = "O";
                feedbackElement.className = "feedback correct";
            } else {
                incorrectAnswers.push(question);
                feedbackElement.textContent = `X (정답: ${question.itemName})`;
                feedbackElement.className = "feedback incorrect";
            }
            disableOptions();
            setTimeout(() => {
                nextQuestion();
            }, 1000);
        }

        function disableOptions() {
            document.querySelectorAll(".option").forEach(option => {
                option.disabled = true;
            });
        }

        function nextQuestion() {
            currentQuestionIndex++;
            if (currentQuestionIndex < quizQuestions.length) {
                showQuestion();
            } else {
                showResults();
            }
        }

        function updateProgress() {
            document.getElementById("progress").textContent = `${currentQuestionIndex + 1} / ${quizQuestions.length}`;
        }

        function showResults() {
            showScreen("result-screen");
            const resultsElement = document.getElementById("quiz-results");
            resultsElement.innerHTML = `
                <h3>맞춘 문제 (${correctAnswers.length})</h3>
                ${correctAnswers.map(q => `<p class="correct">HS 부호: ${q.hsCode}, 품목명: ${q.itemName}</p>`).join("")}
                <h3>틀린 문제 (${incorrectAnswers.length})</h3>
                ${incorrectAnswers.map(q => `<p class="incorrect">HS 부호: ${q.hsCode}, 품목명: ${q.itemName}</p>`).join("")}
            `;
        }

        function showScreen(screenId) {
            document.querySelectorAll(".screen").forEach(screen => screen.classList.remove("active"));
            document.getElementById(screenId).classList.add("active");
        }

        document.getElementById("retry-button").addEventListener("click", () => {
            quizQuestions = generateQuizQuestions();
            startQuiz();
        });

        document.getElementById("capture-button").addEventListener("click", () => {
            html2canvas(document.querySelector("#result-screen")).then(canvas => {
                const link = document.createElement("a");
                link.href = canvas.toDataURL("image/png");
                link.download = "HS마스터_퀴즈결과.png";
                link.click();
            });
        });
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
</body>
</html>
